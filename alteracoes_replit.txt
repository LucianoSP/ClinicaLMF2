Alterações necessárias no Replit:

1. Adicione os novos campos na tabela `auditoria_execucoes` no Supabase:
```sql
ALTER TABLE auditoria_execucoes
ADD COLUMN total_fichas INTEGER DEFAULT 0,
ADD COLUMN total_execucoes INTEGER DEFAULT 0,
ADD COLUMN total_resolvidas INTEGER DEFAULT 0;
```

2. Atualize o arquivo `database_supabase.py`:
```python
def registrar_execucao_auditoria(
    data_inicial: str = None,
    data_final: str = None,
    total_protocolos: int = 0,
    total_divergencias: int = 0,
    divergencias_por_tipo: dict = None,
    total_fichas: int = 0,
    total_execucoes: int = 0,
    total_resolvidas: int = 0
) -> bool:
    """Registra uma nova execução de auditoria com seus metadados."""
    try:
        logging.info(f"Registrando execução de auditoria com {total_fichas} fichas e {total_execucoes} execuções")
        data = {
            "data_execucao": datetime.now(timezone.utc).isoformat(),
            "data_inicial": data_inicial,
            "data_final": data_final,
            "total_protocolos": total_protocolos,
            "total_divergencias": total_divergencias,
            "divergencias_por_tipo": divergencias_por_tipo or {},
            "total_fichas": total_fichas,
            "total_execucoes": total_execucoes,
            "total_resolvidas": total_resolvidas
        }

        response = supabase.table("auditoria_execucoes").insert(data).execute()
        if response.data:
            logging.info("Execução de auditoria registrada com sucesso")
            return True
        else:
            logging.error("Erro ao registrar execução de auditoria: response.data está vazio")
            return False

    except Exception as e:
        logging.error(f"Erro ao registrar execução de auditoria: {str(e)}")
        traceback.print_exc()
        return False


def obter_ultima_auditoria():
    """Obtém o resultado da última auditoria realizada e calcula estatísticas das divergências."""
    try:
        # Busca a última execução de auditoria
        response = (
            supabase.table("auditoria_execucoes")
            .select("*")
            .order("data_execucao", desc=True)
            .limit(1)
            .execute()
        )

        if not response.data:
            return {
                "total_protocolos": 0,
                "total_divergencias": 0,
                "divergencias_por_tipo": {},
                "total_fichas": 0,
                "total_execucoes": 0,
                "total_resolvidas": 0,
                "data_execucao": None,
                "tempo_execucao": None
            }

        ultima_auditoria = response.data[0]

        # Calcula o tempo desde a última execução
        data_execucao = datetime.fromisoformat(ultima_auditoria["data_execucao"].replace("Z", "+00:00"))
        agora = datetime.now(timezone.utc)
        diferenca = agora - data_execucao

        # Formata o tempo de execução
        if diferenca.days > 0:
            tempo_execucao = f"Há {diferenca.days} dias"
        elif diferenca.seconds > 3600:
            tempo_execucao = f"Há {diferenca.seconds // 3600} horas"
        elif diferenca.seconds > 60:
            tempo_execucao = f"Há {diferenca.seconds // 60} minutos"
        else:
            tempo_execucao = f"Há {diferenca.seconds} segundos"

        return {
            "total_protocolos": ultima_auditoria.get("total_protocolos", 0),
            "total_divergencias": ultima_auditoria.get("total_divergencias", 0),
            "divergencias_por_tipo": ultima_auditoria.get("divergencias_por_tipo", {}),
            "total_fichas": ultima_auditoria.get("total_fichas", 0),
            "total_execucoes": ultima_auditoria.get("total_execucoes", 0),
            "total_resolvidas": ultima_auditoria.get("total_resolvidas", 0),
            "data_execucao": ultima_auditoria["data_execucao"],
            "tempo_execucao": tempo_execucao
        }

    except Exception as e:
        logging.error(f"Erro ao obter última auditoria: {str(e)}")
        traceback.print_exc()
        return None
```

3. Atualize o arquivo `auditoria.py`:
```python
def realizar_auditoria_fichas_execucoes(
    data_inicial: str = None, data_final: str = None
):
    """
    Realiza a auditoria cruzando dados entre as tabelas de fichas_presenca e execucoes,
    registrando divergências encontradas.

    Args:
        data_inicial: Data inicial para filtrar (formato: YYYY-MM-DD ou DD/MM/YYYY)
        data_final: Data final para filtrar (formato: YYYY-MM-DD ou DD/MM/YYYY)
    """
    logging.info("Iniciando processo de auditoria de fichas vs execuções...")
    start_time = datetime.now()

    try:
        # Limpa divergências antigas antes de começar nova auditoria
        limpar_divergencias_db()
        logging.info("Divergências antigas removidas com sucesso")

        # Converte datas para formato ISO se necessário
        if data_inicial and "/" in data_inicial:
            data_inicial = datetime.strptime(data_inicial, "%d/%m/%Y").strftime("%Y-%m-%d")
        if data_final and "/" in data_final:
            data_final = datetime.strptime(data_final, "%d/%m/%Y").strftime("%Y-%m-%d")

        # Busca todas as fichas de presença, execuções e guias
        fichas = listar_fichas_presenca(limit=0)
        execucoes = listar_execucoes(limit=0)
        guias = listar_guias(limit=0)  

        if not isinstance(fichas, list):
            fichas = []
        if not isinstance(execucoes, list):
            execucoes = []
        if not isinstance(guias, list):
            guias = []

        # Filtra por data se necessário
        if data_inicial:
            fichas = [f for f in fichas if f.get("data_atendimento") and f["data_atendimento"] >= data_inicial]
            execucoes = [e for e in execucoes if e.get("data_execucao") and e["data_execucao"] >= data_inicial]
        if data_final:
            fichas = [f for f in fichas if f.get("data_atendimento") and f["data_atendimento"] <= data_final]
            execucoes = [e for e in execucoes if e.get("data_execucao") and e["data_execucao"] <= data_final]

        logging.info(f"Total de fichas após filtro: {len(fichas)}")
        logging.info(f"Total de execuções após filtro: {len(execucoes)}")

        # ... resto do código ...

        # No final, registra os metadados da auditoria
        registrar_execucao_auditoria(
            data_inicial=data_inicial,
            data_final=data_final,
            total_protocolos=len(fichas),
            total_divergencias=divergencias_encontradas,
            divergencias_por_tipo={
                "execucao_sem_ficha": total_execucoes_sem_ficha,
                "ficha_sem_execucao": total_fichas_sem_execucao,
                "data_divergente": total_datas_divergentes,
                "ficha_sem_assinatura": total_fichas_sem_assinatura,
                "guia_vencida": total_guias_vencidas,
                "quantidade_excedida": total_quantidade_excedida
            },
            total_fichas=len(fichas),
            total_execucoes=len(execucoes),
            total_resolvidas=0
        )
```

Depois de atualizar os arquivos no Replit, execute a auditoria novamente para testar se os novos campos estão sendo preenchidos corretamente.
